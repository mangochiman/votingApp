<script type="text/javascript">
  var currentCompetitionID;
  
  function participateCompetition(competitionID){
    window.location = "/predictions/" + competitionID;
  }

  function confirmAction(competitionID){
    currentCompetitionID = competitionID
    $('#myModal').modal('show');
  }

  function withdrawFromCompetition(){
    jQuery.ajax({
      type: "POST",
      url: "/home/withdraw_from_competition",
      data: "competition_id=" + currentCompetitionID,
      success: function(){
        window.location = '/voter';
      }

    });
  }

</script>
<style type="text/css">
  #nick_name, #competition_name{
    font-weight: bold;
  }
</style>

<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header">Competitions</h1>
  </div>
  <!-- /.col-lg-12 -->
</div>

<% if flash[:notice] %>
  <div class="alert alert-success alert-dismissable">
    <button aria-hidden="true" data-dismiss="alert" class="close" type="button">Ã—</button>
    <%= flash[:notice] %>
  </div>
<% end %>

<div class="row">

  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        Competitions (<%= @competitions.count %>)
      </div>
      <!-- /.panel-heading -->
      <div class="panel-body">
        <div class="table-responsive">
          <table class="table table-striped table-bordered table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Competition Name</th>
                <th>Required Votes</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Total Voters</th>
                <th>Tournament Name</th>
                <th style="text-align: center;" colspan="2">Action</th>
              </tr>
            </thead>
            <tbody>
              <% count = 0 %>
              <% @competitions.each do |competition| %>
                <tr>
                  <td><%= count = count + 1 %></td>
                  <td><%= competition.name %></td>
                  <td><%= competition.max_votes %></td>
                  <td><%= competition.start_date %></td>
                  <td><%= competition.end_date %></td>
                  <td><button class="btn btn-info btn-block" type="button"><%= competition.total_voters.count %></button></td>
                  <td><%= competition.tournament.name %></td>
                  <% if competition.tournament.open_for_votes== true %>
                    <% if @user.participated_in_competition(competition) %>
                      <td><button onmousedown="participateCompetition(<%= competition.voting_type_id %>)" class="btn btn-primary btn-block" type="button">Edit Predictions</button></td>
                    <% else %>
                      <td><button onmousedown="participateCompetition(<%= competition.voting_type_id %>)" class="btn btn-primary btn-block" type="button">Participate</button></td>
                    <% end %>
                    <% if @user.participated_in_competition(competition) %>
                      <td><button onmousedown="confirmAction(<%= competition.voting_type_id %>)" class="btn btn-danger btn-block" type="button">Withdraw</button></td>
                    <% else %>
                      <td><button class="btn btn-danger btn-block disabled" type="button">Withdraw</button></td>
                    <% end %>
                  <% else %>
                        <td colspan="2"><button class="btn btn-danger btn-block disabled" type="button">Not Open for Votes</button></td>
                  <% end %>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  <!-- /.col-lg-6 -->
</div>

<!--CONFIRMATION POPUP BEGIN -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">
          Withdraw Confirmation
        </h4>
      </div>
      <div class="modal-body">
        <span style="text-align:center;">You are about to withdraw  from this competition. This means you are going to lose all predictions you made in this
          competition. You can not undo this action. Are you really very sure?</span>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="withdrawFromCompetition();" data-dismiss="modal">Okay</button>
          <button type="button" class="btn" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!--CONFIRMATION POPUP END -->
